# Story 5.6: Frontend Skill Breakdown UI

## Status
Draft

## Story
**As a** job seeker,
**I want** to see detailed skill breakdown in my CV analysis,
**So that** I understand my strengths and areas for improvement.

## Acceptance Criteria
1. Tạo `SkillBreakdownCard` component
2. Hiển thị 4 sub-scores với progress bars
3. Tạo `SkillCategoriesDisplay` component với skill badges
4. Skill badges color-coded theo category
5. Tạo `SkillRecommendations` component
6. Integrate vào CV analysis result page
7. Responsive design cho mobile

## Tasks / Subtasks

- [ ] Task 1: Update shared-types with new skill-related interfaces (AC: 1, 3, 5)
  - [ ] Open `packages/shared-types/src/cv-analysis.ts`
  - [ ] Add `SkillBreakdown` interface:
    - [ ] `completeness_score: number` (0-7)
    - [ ] `categorization_score: number` (0-6)
    - [ ] `evidence_score: number` (0-6)
    - [ ] `market_relevance_score: number` (0-6)
    - [ ] `total_score: number` (0-25)
  - [ ] Add `SkillCategories` interface:
    - [ ] `programming_languages: string[]`
    - [ ] `frameworks: string[]`
    - [ ] `databases: string[]`
    - [ ] `devops: string[]`
    - [ ] `soft_skills: string[]`
    - [ ] `ai_ml?: string[]` (optional)
    - [ ] `other: string[]`
  - [ ] Update `CVAnalysis` interface to include new optional fields:
    - [ ] `skill_breakdown?: SkillBreakdown | null`
    - [ ] `skill_categories?: SkillCategories | null`
    - [ ] `skill_recommendations?: string[] | null`
  - [ ] Export new interfaces from `packages/shared-types/src/index.ts`
  - [ ] Run `npm run build` in packages/shared-types to compile TypeScript
  - [ ] [Source: docs/stories/5.3.story.md - Backend schema definition]

- [ ] Task 2: Create SkillBreakdownCard component (AC: 1, 2)
  - [ ] Create file `frontend/features/cv/components/SkillBreakdownCard.tsx`
  - [ ] Component props: `breakdown: SkillBreakdown`
  - [ ] Display total skill score (0-25) prominently at top with color coding:
    - [ ] 20-25: Green (excellent)
    - [ ] 15-19: Blue (good)
    - [ ] 10-14: Yellow (fair)
    - [ ] 0-9: Orange (needs improvement)
  - [ ] Render 4 progress bars for sub-scores:
    - [ ] Completeness (0-7): Blue progress bar with label
    - [ ] Categorization (0-6): Green progress bar with label
    - [ ] Evidence (0-6): Purple progress bar with label
    - [ ] Market Relevance (0-6): Orange progress bar with label
  - [ ] Progress bar implementation:
    - [ ] Use percentage calculation: `(score / max) * 100`
    - [ ] Display as horizontal bar with fill animation
    - [ ] Show score text: "X/Y" next to bar
  - [ ] Use Tailwind CSS for styling following project patterns [Source: docs/architecture/tech-stack.md]
  - [ ] Use `cn()` utility from `@/lib/utils` for conditional classes [Source: docs/architecture/frontend-architecture.md#component-template]
  - [ ] Add proper TypeScript types for all props and internal state
  - [ ] Component should be responsive (stack vertically on mobile)

- [ ] Task 3: Create SkillCategoriesDisplay component (AC: 3, 4)
  - [ ] Create file `frontend/features/cv/components/SkillCategoriesDisplay.tsx`
  - [ ] Component props: `categories: SkillCategories`
  - [ ] Display skills grouped by category with headers:
    - [ ] Programming Languages section
    - [ ] Frameworks section
    - [ ] Databases section
    - [ ] DevOps section
    - [ ] Soft Skills section
    - [ ] AI/ML section (if present)
    - [ ] Other section (if not empty)
  - [ ] Implement color-coded skill badges:
    - [ ] Programming Languages: Blue (`bg-blue-100 text-blue-800`)
    - [ ] Frameworks: Green (`bg-green-100 text-green-800`)
    - [ ] Databases: Purple (`bg-purple-100 text-purple-800`)
    - [ ] DevOps: Orange (`bg-orange-100 text-orange-800`)
    - [ ] Soft Skills: Pink (`bg-pink-100 text-pink-800`)
    - [ ] AI/ML: Indigo (`bg-indigo-100 text-indigo-800`)
    - [ ] Other: Gray (`bg-gray-100 text-gray-800`)
  - [ ] Badge styling: Rounded corners, padding, inline-flex
  - [ ] Use flex-wrap for skill badges within each category
  - [ ] Show skill count per category (e.g., "Programming Languages (5)")
  - [ ] Handle empty categories gracefully (don't display if empty)
  - [ ] Responsive layout: categories stack on mobile, grid on desktop

- [ ] Task 4: Create SkillRecommendations component (AC: 5)
  - [ ] Create file `frontend/features/cv/components/SkillRecommendations.tsx`
  - [ ] Component props: `recommendations: string[]`
  - [ ] Display recommendations as a list with icons:
    - [ ] Use lightbulb icon or similar for each recommendation
    - [ ] Style as info/suggestion cards with light background
    - [ ] Each recommendation in its own card/row
  - [ ] Handle empty recommendations: show "No recommendations at this time" message
  - [ ] Add visual hierarchy: title "Recommendations" with icon
  - [ ] Use consistent spacing and typography from existing components [Source: frontend/features/cv/components/CVAnalysisResults.tsx]

- [ ] Task 5: Integrate new components into CVAnalysisResults (AC: 6)
  - [ ] Open `frontend/features/cv/components/CVAnalysisResults.tsx`
  - [ ] Import new components:
    - [ ] `import { SkillBreakdownCard } from './SkillBreakdownCard';`
    - [ ] `import { SkillCategoriesDisplay } from './SkillCategoriesDisplay';`
    - [ ] `import { SkillRecommendations } from './SkillRecommendations';`
  - [ ] Add new section after "CV Quality Score" section (around line 107):
    - [ ] Section title: "Skill Analysis"
    - [ ] Conditional rendering: only show if `analysis.skill_breakdown` exists
    - [ ] Render `<SkillBreakdownCard breakdown={analysis.skill_breakdown} />`
  - [ ] Update "Extracted Skills" section (around line 157-163):
    - [ ] Check if `analysis.skill_categories` exists
    - [ ] If yes, render `<SkillCategoriesDisplay categories={analysis.skill_categories} />`
    - [ ] If no, fall back to existing `<SkillCloud skills={analysis.extracted_skills || []} />` [Source: frontend/features/cv/components/SkillCloud.tsx]
    - [ ] Update section title to "Skills Breakdown" when using SkillCategoriesDisplay
  - [ ] Add new section after Skills section:
    - [ ] Section title: "Skill Development Recommendations"
    - [ ] Conditional rendering: only show if `analysis.skill_recommendations` exists and has items
    - [ ] Render `<SkillRecommendations recommendations={analysis.skill_recommendations} />`
  - [ ] Maintain existing white rounded card styling for consistency [Source: frontend/features/cv/components/CVAnalysisResults.tsx:79-106]

- [ ] Task 6: Add responsive design and accessibility (AC: 7)
  - [ ] Verify all new components use responsive Tailwind breakpoints:
    - [ ] `sm:` for small screens (640px+)
    - [ ] `md:` for medium screens (768px+)
    - [ ] `lg:` for large screens (1024px+)
  - [ ] Test layout on mobile viewport (320px-640px):
    - [ ] Progress bars should be full width on mobile
    - [ ] Skill badges should wrap properly
    - [ ] Text should remain readable (no overflow)
  - [ ] Add ARIA labels where appropriate:
    - [ ] Progress bars: `aria-label="Completeness score: X out of 7"`
    - [ ] Skill badges: Semantic HTML with proper grouping
  - [ ] Ensure color contrast meets WCAG AA standards for all badge colors
  - [ ] Test with screen reader (basic semantic HTML validation)

- [ ] Task 7: Write unit tests for new components (AC: 1, 2, 3, 4, 5)
  - [ ] Create `frontend/features/cv/components/SkillBreakdownCard.test.tsx`:
    - [ ] Test: Renders all 4 sub-scores with correct values
    - [ ] Test: Calculates percentages correctly for progress bars
    - [ ] Test: Applies correct color based on total score (green/blue/yellow/orange)
    - [ ] Test: Handles edge cases (score 0, max score 25)
    - [ ] Test: Renders score labels in "X/Y" format
  - [ ] Create `frontend/features/cv/components/SkillCategoriesDisplay.test.tsx`:
    - [ ] Test: Renders all populated categories
    - [ ] Test: Does not render empty categories
    - [ ] Test: Applies correct color for each category type
    - [ ] Test: Shows skill count per category
    - [ ] Test: Handles empty categories object gracefully
  - [ ] Create `frontend/features/cv/components/SkillRecommendations.test.tsx`:
    - [ ] Test: Renders all recommendations as list items
    - [ ] Test: Shows empty state message when no recommendations
    - [ ] Test: Renders with icon for each recommendation
  - [ ] Update `frontend/features/cv/components/CVAnalysisResults.test.tsx`:
    - [ ] Test: New Skill Analysis section renders when skill_breakdown present
    - [ ] Test: SkillCategoriesDisplay used when skill_categories present
    - [ ] Test: Falls back to SkillCloud when skill_categories absent
    - [ ] Test: Recommendations section renders when recommendations present
    - [ ] Test: Recommendations section hidden when array empty/null
  - [ ] Follow existing test patterns [Source: frontend/features/cv/components/CVAnalysisResults.test.tsx]
  - [ ] Use Jest and React Testing Library [Source: docs/architecture/testing-strategy.md#frontend-component-test]
  - [ ] Run tests: `npm test -- SkillBreakdownCard SkillCategoriesDisplay SkillRecommendations`

- [ ] Task 8: Manual UI/UX testing (AC: 7)
  - [ ] Test with real CV analysis data containing skill_breakdown:
    - [ ] Upload a test CV or use existing analyzed CV
    - [ ] Verify new sections appear in correct order
    - [ ] Check progress bar animations work smoothly
    - [ ] Verify skill badges wrap correctly with many skills
  - [ ] Test responsive behavior:
    - [ ] Desktop (1920x1080): Verify grid layouts
    - [ ] Tablet (768x1024): Verify medium breakpoints
    - [ ] Mobile (375x667): Verify stacked layout
  - [ ] Test edge cases:
    - [ ] CV without skill_breakdown (should not crash, old UI remains)
    - [ ] Empty skill categories (should handle gracefully)
    - [ ] Very long skill names (should not break layout)
    - [ ] 100+ skills across categories (performance and layout)
  - [ ] Cross-browser testing:
    - [ ] Chrome/Edge (primary)
    - [ ] Firefox (secondary)
    - [ ] Safari (if available)

## Dev Notes

### Previous Story Insights
- **Story 5.3 (Database Schema Update):** Added `skill_breakdown`, `skill_categories`, `skill_recommendations` columns to `cv_analyses` table as JSONB fields. Backend API now returns these fields in the `CVAnalysis` response when available. [Source: docs/stories/5.3.story.md]
- **Story 5.4 (AI Service Integration):** AI analysis pipeline populates the new skill fields automatically. For CVs analyzed after Story 5.4 deployment, `skill_breakdown` will be present. Older CVs will have null values (backward compatibility maintained). [Source: docs/stories/5.4.story.md]
- **Story 5.5 (Skill-JD Matching):** Implemented skill matching functionality but did not add UI components. This story focuses purely on adding UI for skill display. [Source: docs/stories/5.5.story.md]

### Data Models
- **CVAnalysis Interface:** Located at `packages/shared-types/src/cv-analysis.ts`
  - Currently has: `extracted_skills: string[] | null`
  - Need to add: `skill_breakdown`, `skill_categories`, `skill_recommendations` as optional fields
  - Backend already returns these fields when available (Story 5.4)
  - [Source: packages/shared-types/src/cv-analysis.ts]

- **SkillBreakdown Structure (from PRD):**
  ```typescript
  {
    completeness_score: number;      // 0-7
    categorization_score: number;    // 0-6
    evidence_score: number;          // 0-6
    market_relevance_score: number;  // 0-6
    total_score: number;             // 0-25
  }
  ```
  [Source: docs/prd/5-hybrid-skill-scoring-epic.md#5.4.2]

- **SkillCategories Structure (from PRD):**
  ```typescript
  {
    programming_languages: string[];
    frameworks: string[];
    databases: string[];
    devops: string[];
    soft_skills: string[];
    ai_ml?: string[];
    other: string[];
  }
  ```
  [Source: docs/prd/5-hybrid-skill-scoring-epic.md#5.4.2]

### Component Specifications
- **Existing CVAnalysisResults Component:** Located at `frontend/features/cv/components/CVAnalysisResults.tsx`
  - Currently displays: Score gauge, summary, experience breakdown, skills cloud, feedback
  - Layout: Vertical stack of white rounded cards with shadows
  - Styling pattern: `bg-white rounded-lg shadow p-6` for each section
  - Already handles conditional rendering and polling for analysis status
  - [Source: frontend/features/cv/components/CVAnalysisResults.tsx]

- **Existing SkillCloud Component:** Located at `frontend/features/cv/components/SkillCloud.tsx`
  - Simple badge display for flat skill array
  - Styling: `bg-blue-100 text-blue-800` badges
  - Will remain as fallback for older CVs without skill_categories
  - [Source: frontend/features/cv/components/SkillCloud.tsx]

- **Existing ScoreGauge Component:** Located at `frontend/features/cv/components/ScoreGauge.tsx`
  - Displays 0-100 score with color coding and gauge visualization
  - Pattern to follow for SkillBreakdownCard total score display
  - Color logic: Red (<60), Yellow (60-79), Green (80+)
  - [Source: frontend/features/cv/components/ScoreGauge.tsx]

### File Locations
- **New Component Files:**
  - `frontend/features/cv/components/SkillBreakdownCard.tsx` - Displays skill score breakdown with progress bars
  - `frontend/features/cv/components/SkillCategoriesDisplay.tsx` - Displays categorized skills with colored badges
  - `frontend/features/cv/components/SkillRecommendations.tsx` - Displays skill recommendations list
  - [Source: docs/prd/5-hybrid-skill-scoring-epic.md#5.3.1]

- **Files to Modify:**
  - `packages/shared-types/src/cv-analysis.ts` - Add new interface definitions
  - `packages/shared-types/src/index.ts` - Export new interfaces
  - `frontend/features/cv/components/CVAnalysisResults.tsx` - Integrate new components
  - [Source: Project structure analysis]

- **Test Files:**
  - `frontend/features/cv/components/SkillBreakdownCard.test.tsx`
  - `frontend/features/cv/components/SkillCategoriesDisplay.test.tsx`
  - `frontend/features/cv/components/SkillRecommendations.test.tsx`
  - `frontend/features/cv/components/CVAnalysisResults.test.tsx` (update existing)
  - [Source: docs/architecture/testing-strategy.md#frontend-tests]

### Technical Constraints
- **Frontend Framework:** Next.js 16.0.5 with React 19.2.0 [Source: docs/architecture/tech-stack.md]
- **TypeScript Version:** ~5 with strict type checking enabled [Source: docs/architecture/tech-stack.md]
- **Styling:** Tailwind CSS ^4 with utility-first approach [Source: docs/architecture/tech-stack.md]
- **UI Components:** shadcn/ui components where applicable (Button, Card, Badge patterns) [Source: docs/architecture/tech-stack.md]
- **State Management:** React hooks (useState, useEffect) for local component state [Source: docs/architecture/frontend-architecture.md#state-management-architecture]
- **Naming Conventions:**
  - Components: `PascalCase` (e.g., `SkillBreakdownCard`)
  - Files: `PascalCase.tsx` for components
  - Props interfaces: `ComponentNameProps` pattern
  - [Source: docs/architecture/coding-standards.md#naming-conventions]

### Project Structure Notes
- **Feature-First Architecture:** Components organized under `frontend/features/cv/components/` [Source: docs/architecture/frontend-architecture.md#component-organization]
- **Shared Types Package:** All TypeScript interfaces shared between frontend/backend must be in `packages/shared-types` [Source: docs/architecture/coding-standards.md#type-sharing]
- **Component Co-location:** Test files co-located with components using `.test.tsx` suffix [Source: docs/architecture/testing-strategy.md#frontend-tests]

### Styling Guidelines
- **Color Palette for Categories (following PRD mockup):**
  - Programming Languages: Blue shades
  - Frameworks: Green shades
  - Databases: Purple shades
  - DevOps: Orange shades
  - Soft Skills: Pink shades
  - AI/ML: Indigo shades
  - [Source: docs/prd/5-hybrid-skill-scoring-epic.md#5.3.2]

- **Progress Bar Design:**
  - Horizontal bars with percentage fill
  - Show score as fraction (X/Y) next to bar
  - Use CSS transitions for smooth fill animations
  - Follow existing design system spacing (gap-4, p-6, etc.)
  - [Source: frontend/features/cv/components/CVAnalysisResults.tsx styling patterns]

- **Responsive Breakpoints:**
  - Mobile-first approach
  - `sm:` 640px+ for small tablets
  - `md:` 768px+ for tablets
  - `lg:` 1024px+ for desktops
  - [Source: Tailwind CSS defaults, docs/architecture/tech-stack.md]

### Testing
#### Test Framework and Location
- Framework: Jest with React Testing Library for component tests [Source: docs/architecture/testing-strategy.md#frontend-component-test]
- Test location: Co-located with components in `frontend/features/cv/components/` [Source: docs/architecture/testing-strategy.md#frontend-tests]
- Run commands:
  - All CV feature tests: `npm test -- features/cv`
  - Specific component: `npm test -- SkillBreakdownCard`
  - Watch mode: `npm test -- --watch`

#### Test Scenarios Required
1. **SkillBreakdownCard Tests:**
   - Renders all 4 sub-scores with correct labels and values
   - Progress bars calculate percentages correctly
   - Color coding matches score ranges (green/blue/yellow/orange)
   - Handles edge cases: zero scores, maximum scores
   - Responsive layout on mobile vs desktop

2. **SkillCategoriesDisplay Tests:**
   - Renders only non-empty categories
   - Applies correct badge color per category type
   - Shows skill count in category headers
   - Handles empty categories object
   - Wraps skills properly with many items

3. **SkillRecommendations Tests:**
   - Renders list of recommendations with icons
   - Shows empty state when no recommendations
   - Handles undefined/null input gracefully

4. **CVAnalysisResults Integration Tests:**
   - New sections appear when skill data present
   - Falls back to old SkillCloud when skill_categories absent
   - Maintains existing functionality (score, summary, feedback)
   - Handles CVs with and without new skill fields

#### Test Fixtures Needed
- Sample `SkillBreakdown` object with realistic scores
- Sample `SkillCategories` object with multiple skills per category
- Sample `skill_recommendations` array
- Sample `CVAnalysis` object with and without new skill fields (for backward compatibility testing)
- [Source: frontend/features/cv/components/CVAnalysisResults.test.tsx patterns]

### Backward Compatibility Notes
- **Critical:** New UI components must handle missing data gracefully
- CVs analyzed before Story 5.4 deployment will have `null` values for:
  - `skill_breakdown`
  - `skill_categories`
  - `skill_recommendations`
- When these fields are `null`, the UI should:
  - Not render the Skill Analysis section (SkillBreakdownCard)
  - Fall back to existing SkillCloud component for extracted_skills
  - Not render the Recommendations section
- Existing UI for score, summary, and feedback must remain unchanged
- [Source: docs/prd/5-hybrid-skill-scoring-epic.md#5.2.2-NFR-SS3]

### Design Reference
Reference the PRD mockup for visual design:
```
┌─────────────────────────────────────────────────────────────┐
│ Skill Analysis                                    Score: 21/25 │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ Breakdown:                                              │ │
│ │  Completeness      ████████░░  7/7                      │ │
│ │  Categorization    █████░░░░░  5/6                      │ │
│ │  Evidence          ████░░░░░░  4/6                      │ │
│ │  Market Relevance  █████░░░░░  5/6                      │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ Extracted Skills (15 skills found):                     │ │
│ │                                                         │ │
│ │ Programming:  [Python] [JavaScript] [TypeScript]        │ │
│ │ Frameworks:   [React] [FastAPI] [Next.js]               │ │
│ │ Databases:    [PostgreSQL] [Redis] [MongoDB]            │ │
│ │ DevOps:       [Docker] [AWS] [CI/CD]                    │ │
│ │ Soft Skills:  [Teamwork] [Communication] [Leadership]   │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ Recommendations:                                        │ │
│ │ - Consider learning Kubernetes - hot skill in 2024      │ │
│ │ - Add proficiency levels to your skills                 │ │
│ │ - Include more evidence of skill usage in experience    │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```
[Source: docs/prd/5-hybrid-skill-scoring-epic.md#5.3.2]

## Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-12-17 | 1.0 | Initial draft of Story 5.6 - Frontend Skill Breakdown UI | Bob (Scrum Master) |

---

## Dev Agent Record

### Agent Model Used
<!-- To be filled by Dev Agent -->

### Debug Log References
<!-- To be filled by Dev Agent -->

### Completion Notes List
<!-- To be filled by Dev Agent -->

### File List
<!-- To be filled by Dev Agent -->

---

## QA Results
<!-- To be filled by QA Agent -->
