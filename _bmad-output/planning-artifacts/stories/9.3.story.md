# Story 9.3: Job Application Flow

## Status
in-progress

## Parent Story
Epic 9: Advanced Job Search Application

## Description
Implement the complete flow for a Job Seeker to view job details and submit an application.

## Tasks

### Backend Implementation

- [x] **Task 1: Application Model**
    - [x] Create `Application` model in `jobs` module (or new `applications` module? Let's keep in `jobs` for simple relation, or `applications` for separation. Decided: `jobs` module for now as it's tightly coupled).

    - [x] Fields: `id`, `job_id` (FK), `user_id` (FK), `cv_id` (FK), `cover_letter` (Text), `status` (pending, reviewed, rejected, accepted), `created_at`.
    - [x] Unique constraint: User can apply to a Job only once.
    - [x] Create Migration.

- [x] **Task 2: Job Detail Endpoint**
    - [x] `GET /api/v1/jobs/{id}`.
    - [x] Public access.
    - [x] Return detailed info (including benefits, updated description).

- [x] **Task 3: Apply Endpoint**
    - [x] `POST /api/v1/jobs/{id}/apply`.
    - [x] Auth required.
    - [x] Body: `cv_id` (UUID), `cover_letter` (Optional[str]).
    - [x] Validate CV belongs to User.
    - [x] Validate Job is active.
    - [x] Check for duplicate application.
    - [x] **Tests**: `backend/tests/modules/jobs/test_job_application.py`


### Frontend Implementation

- [x] **Task 4: Job Service & Types**
    - [x] Add `getJobDetail(id)` to service.
    - [x] Add `applyJob(id, cvId, coverLetter)` to service.
    - [x] Update types.

- [x] **Task 5: Job Detail Page**
    - [x] Create `frontend/app/jobs/[id]/page.tsx`.
    - [x] Fetch job data (SSR or Client).
    - [x] Display Layout: Header, Title, Salary, Location, Description, Requirements, Benefits.
    - [x] "Apply Now" button (Stick to bottom on mobile, Sidebar on desktop).

- [x] **Task 6: Application Modal**
    - [x] Create `ApplyJobModal` component.
    - [x] List user's active CVs (Need `getMyCVs` service/action if not exists. It likely exists in `cv` module).
    - [x] Textarea for Cover Letter.
    - [x] Submit handling with loading state and success toast.

## Technical Notes
- **Application Statuses**: `pending`, `reviewed`, `shortlisted`, `rejected`, `accepted`.
- **CV Selection**: User needs to have uploaded CVs. If no CV, prompt to upload (Link to CV management).
