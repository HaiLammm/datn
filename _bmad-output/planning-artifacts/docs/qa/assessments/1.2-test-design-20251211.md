# Test Design: Story 1.2

Date: 2025-12-11
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 24
- Unit tests: 8 (33%)
- Integration tests: 10 (42%)
- E2E tests: 6 (25%)
- Priority distribution: P0: 18, P1: 6, P2: 0

## Test Scenarios by Acceptance Criteria

### AC1: Given I have uploaded a CV and the analysis is complete, when I navigate to the CV analysis page, I should see a comprehensive breakdown of my CV including skills, experience, and quality score.

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 1.2-UNIT-001 | Unit        | P0       | Validate CV breakdown data structure parsing | Pure data transformation logic |
| 1.2-UNIT-002 | Unit        | P0       | Validate skills extraction from AI response | Algorithm for skill parsing |
| 1.2-UNIT-003 | Unit        | P0       | Validate experience summary parsing | Text processing logic |
| 1.2-INT-001  | Integration | P0       | API returns complete breakdown for completed analysis | Component interaction with DB |
| 1.2-INT-002  | Integration | P0       | API handles missing analysis data gracefully | Error handling at service layer |
| 1.2-E2E-001  | E2E         | P0       | User sees full CV breakdown after analysis completion | Critical user journey validation |

### AC2: Given I have uploaded a CV, when I view the analysis results, I should see specific feedback on formatting improvements and ATS compatibility hints.

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 1.2-UNIT-004 | Unit        | P0       | Validate formatting feedback parsing from AI | Text extraction algorithm |
| 1.2-UNIT-005 | Unit        | P0       | Validate ATS compatibility hints extraction | Logic for hint categorization |
| 1.2-INT-003  | Integration | P0       | API includes formatting and ATS feedback in response | Data retrieval from DB |
| 1.2-E2E-002  | E2E         | P0       | User sees formatting and ATS feedback in results | User-facing feature validation |

### AC3: Given I have uploaded a CV, when I view the analysis results, I should see an overall quality score (0-100) with explanation of the scoring criteria.

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 1.2-UNIT-006 | Unit        | P0       | Validate quality score calculation (0-100 range) | Pure calculation logic |
| 1.2-UNIT-007 | Unit        | P0       | Validate scoring criteria explanation parsing | Text processing for criteria |
| 1.2-INT-004  | Integration | P0       | API returns score and criteria explanation | DB query and response formatting |
| 1.2-E2E-003  | E2E         | P0       | User sees quality score and explanation | Critical scoring display |

### AC4: Given I have uploaded a CV, when I view the analysis results, I should see a summary of my professional profile that highlights key strengths and areas for development.

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 1.2-UNIT-008 | Unit        | P0       | Validate strengths and weaknesses extraction | AI response parsing logic |
| 1.2-INT-005  | Integration | P0       | API includes profile summary in analysis response | Service data aggregation |
| 1.2-E2E-004  | E2E         | P0       | User sees professional profile summary | User experience validation |

### AC5: Given I am a logged-in user, when I access the CV analysis page, I should see a list of all my previously uploaded CVs with their analysis status (Pending/Processing/Completed).

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 1.2-INT-006  | Integration | P1       | API returns user's CV list with correct statuses | DB query for user CVs |
| 1.2-INT-007  | Integration | P1       | API filters CVs by user authentication | Authorization check |
| 1.2-E2E-005  | E2E         | P1       | User sees CV list with status badges | Navigation and display |

### AC6: Given the analysis is still processing, I should see a loading indicator or status update without needing to refresh the page manually.

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 1.2-INT-008  | Integration | P0       | Status endpoint returns PROCESSING state | API status polling |
| 1.2-INT-009  | Integration | P0       | Status endpoint returns COMPLETED when done | State transition handling |
| 1.2-INT-010  | Integration | P0       | Status endpoint handles FAILED state | Error state management |
| 1.2-E2E-006  | E2E         | P0       | User sees loading state and automatic updates | Polling mechanism validation |

## Edge Cases and Error Scenarios

### Additional Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 1.2-INT-011  | Integration | P0       | Handle Ollama service timeout | AI service failure handling |
| 1.2-INT-012  | Integration | P0       | Handle invalid CV file during analysis | Input validation at service layer |
| 1.2-E2E-007  | E2E         | P1       | User experiences analysis failure and sees error message | Error user journey |
| 1.2-E2E-008  | E2E         | P1       | User uploads multiple CVs and sees status updates | Concurrent analysis handling |

## Risk Coverage

- **AI Service Reliability**: Covered by INT-011, E2E-007
- **Data Privacy**: Covered by INT-007 (user filtering)
- **Performance**: Covered by polling mechanism tests
- **User Experience**: Covered by all E2E scenarios

## Recommended Execution Order

1. P0 Unit tests (fail fast on logic errors)
2. P0 Integration tests (validate component interactions)
3. P0 E2E tests (critical user journeys)
4. P1 tests in order
5. Edge cases as time permits

## Test Scenarios with Given-When-Then

### Unit Tests

**1.2-UNIT-001: Validate CV breakdown data structure parsing**
- Given: AI response JSON with skills, experience, score
- When: Parsing function processes the response
- Then: Returns structured CVAnalysis object with all fields populated

**1.2-UNIT-002: Validate skills extraction from AI response**
- Given: AI text containing "Skills: Python, Java, React"
- When: Skill extraction algorithm runs
- Then: Returns array of skill strings

**1.2-UNIT-003: Validate experience summary parsing**
- Given: AI summary text with experience details
- When: Experience parser processes text
- Then: Extracts years of experience and key roles

**1.2-UNIT-004: Validate formatting feedback parsing from AI**
- Given: AI feedback text mentioning formatting issues
- When: Feedback parser runs
- Then: Categorizes feedback into formatting and ATS sections

**1.2-UNIT-005: Validate ATS compatibility hints extraction**
- Given: AI response with ATS hints
- When: Hint extractor processes response
- Then: Returns list of ATS improvement suggestions

**1.2-UNIT-006: Validate quality score calculation (0-100 range)**
- Given: AI score response with value 85
- When: Score validator processes
- Then: Accepts valid range, rejects invalid (<0 or >100)

**1.2-UNIT-007: Validate scoring criteria explanation parsing**
- Given: AI explanation text
- When: Criteria parser runs
- Then: Formats explanation for display

**1.2-UNIT-008: Validate strengths and weaknesses extraction**
- Given: AI profile summary text
- When: Profile analyzer processes
- Then: Separates strengths and development areas

### Integration Tests

**1.2-INT-001: API returns complete breakdown for completed analysis**
- Given: CV with COMPLETED analysis status in DB
- When: GET /cvs/{cv_id}/analysis called
- Then: Returns full analysis data including skills, score, summary

**1.2-INT-002: API handles missing analysis data gracefully**
- Given: CV exists but analysis data is null
- When: Analysis endpoint called
- Then: Returns appropriate error response

**1.2-INT-003: API includes formatting and ATS feedback in response**
- Given: Completed analysis with feedback data
- When: Analysis endpoint called
- Then: Response includes formatting and ATS sections

**1.2-INT-004: API returns score and criteria explanation**
- Given: CV with quality score and explanation
- When: Analysis endpoint called
- Then: Returns score 0-100 and explanation text

**1.2-INT-005: API includes profile summary in analysis response**
- Given: Analysis with strengths and weaknesses
- When: Endpoint called
- Then: Response includes profile summary

**1.2-INT-006: API returns user's CV list with correct statuses**
- Given: User with multiple CVs in different states
- When: GET /cvs called
- Then: Returns list with correct status for each CV

**1.2-INT-007: API filters CVs by user authentication**
- Given: Multiple users with CVs
- When: Authenticated user calls CV list
- Then: Returns only their CVs

**1.2-INT-008: Status endpoint returns PROCESSING state**
- Given: CV in PROCESSING status
- When: GET /cvs/{cv_id}/status called
- Then: Returns "PROCESSING"

**1.2-INT-009: Status endpoint returns COMPLETED when done**
- Given: Background task completes successfully
- When: Status polled after completion
- Then: Returns "COMPLETED"

**1.2-INT-010: Status endpoint handles FAILED state**
- Given: AI analysis fails
- When: Status endpoint called
- Then: Returns "FAILED" with error details

**1.2-INT-011: Handle Ollama service timeout**
- Given: Ollama service is unresponsive
- When: Analysis background task runs
- Then: Sets status to FAILED, logs error

**1.2-INT-012: Handle invalid CV file during analysis**
- Given: Corrupted or invalid CV file
- When: Analysis attempts to process
- Then: Fails gracefully with appropriate error

### E2E Tests

**1.2-E2E-001: User sees full CV breakdown after analysis completion**
- Given: User uploads CV and waits for analysis
- When: Navigates to analysis page after completion
- Then: Sees skills, experience, quality score displayed

**1.2-E2E-002: User sees formatting and ATS feedback in results**
- Given: Analysis completes with feedback
- When: User views results
- Then: Sees formatting improvements and ATS hints

**1.2-E2E-003: User sees quality score and explanation**
- Given: CV analysis includes score
- When: User views analysis
- Then: Sees 0-100 score with criteria explanation

**1.2-E2E-004: User sees professional profile summary**
- Given: Analysis with profile summary
- When: User views results
- Then: Sees strengths and development areas

**1.2-E2E-005: User sees CV list with status badges**
- Given: User has multiple CVs
- When: Accesses CV page
- Then: Sees list with Pending/Processing/Completed badges

**1.2-E2E-006: User sees loading state and automatic updates**
- Given: CV uploaded and analysis starts
- When: User views analysis page during processing
- Then: Sees loading indicator that updates to results without refresh

**1.2-E2E-007: User experiences analysis failure and sees error message**
- Given: Analysis fails due to service error
- When: User checks status
- Then: Sees FAILED status and error message

**1.2-E2E-008: User uploads multiple CVs and sees status updates**
- Given: User uploads several CVs
- When: Views CV list during analysis
- Then: Sees status updates for each CV independently